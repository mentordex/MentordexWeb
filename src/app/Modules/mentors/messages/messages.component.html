<section class="pt-125 py-65 bg-md-f8f8f8">
    <div class="container">
        <div class="row">
            <div class="col-lg-11 mx-auto">
                <div class="profile-steps-rightsidebar-column bg-white">
                    <div class="row">
                        <ng-container *ngIf="noJobsFound; else jobsFound;">
                            <div class="col-md-4 pr-md-0">
                                <div class="chatbox--searcharea">
                                    <div class="position-relative w-100">
                                        <button class="search--btn" type="submit">
                                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                                            <path d="M7.875 14.625C11.6029 14.625 14.625 11.6029 14.625 7.875C14.625 4.14708 11.6029 1.125 7.875 1.125C4.14708 1.125 1.125 4.14708 1.125 7.875C1.125 11.6029 4.14708 14.625 7.875 14.625Z" stroke="#3BB3BD" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                            <path d="M12.9375 12.9375L16.875 16.875" stroke="#3BB3BD" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                            </svg>
                                        </button>
                                        <input type="search" (keyup)='onkeypress($event.target.value)' class="navbar-serach-input w-100 pl-5" placeholder="Search Mentors">
                                    </div>
                                </div>
                                <div class="chatbox-inboxlist">
                                    <ul>

                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-8 border-md-chatarea pl-md-0">
                                <div class="nochat-area">
                                    <div class="mx-auto">
                                        <div class="mx-auto d-blcok text-center mb-3">
                                            <img src="assets/img/noresult-chatboxicon.svg" alt="chatnotfound-icon">
                                        </div>
                                        <p class="mobile-pagetop-heading mb-2 text-center">No Messages Yet</p>
                                        <p class="mobile-pagetop-subheading d-block text-center max-350 mx-auto mb-4">Once you connect with a parent, your messages will be displayed here. </p>

                                    </div>
                                </div>
                            </div>
                        </ng-container>
                        <ng-template #jobsFound>

                            <div class="col-md-5 col-lg-4 pr-md-0">
                                <div class="chatbox--searcharea">
                                    <div class="position-relative w-100">
                                        <button class="search--btn" type="submit">
                                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                                            <path d="M7.875 14.625C11.6029 14.625 14.625 11.6029 14.625 7.875C14.625 4.14708 11.6029 1.125 7.875 1.125C4.14708 1.125 1.125 4.14708 1.125 7.875C1.125 11.6029 4.14708 14.625 7.875 14.625Z" stroke="#3BB3BD" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                            <path d="M12.9375 12.9375L16.875 16.875" stroke="#3BB3BD" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                            </svg>
                                        </button>
                                        <input type="search" (keyup)='onkeypress($event.target.value)' class="navbar-serach-input w-100 pl-5" placeholder="Search Mentors">
                                    </div>
                                </div>
                                <div class="chatbox-inboxlist">
                                    <ul>
                                        <li *ngFor="let parent of parentDetails; let i= index;">
                                            <a href="javascript:void(0)" (click)="getMentorJobsById(id, parent?.job_id)">
                                                <div class="chat-fill-row">
                                                    <div class="chat-list">
                                                        <div class="chat-people">
                                                            <div class="chat-img">
                                                                <img [src]="parent?.parent_profile_image" alt="usericon">
                                                            </div>
                                                            <div class="chat-desc">
                                                                <p>{{parent?.parent_first_name}} {{parent?.parent_last_name}}</p>
                                                                <!--span>When I can reach to you and you can</span-->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </a>
                                        </li>

                                    </ul>
                                </div>
                            </div>
                            <ng-container *ngFor="let job of getJobDetailsArray; let i= index;">
                                <div class="col-md-7 col-lg-8 border-md-chatarea pl-md-0">
                                    <ng-container *ngIf="job?.messages; else noMessagesFound;">
                                        <div class="chatbox-bodyheader">
                                            <div class="row align-items-center">
                                                <div class="col-lg-8">
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <p class="chatbox-bodyheader-name d-block d-lg-inline-block mb-2 mb-lg-0">{{job?.parent?.first_name}} {{job?.parent?.last_name}}</p>
                                                            <!--p class="chatbox-bodyheader-status d-block d-lg-inline-block ml-lg-2">
                                                            <span class="active status--signal"></span> Active now
                                                        </p-->
                                                        </div>
                                                        <div class="col-12 mt-2">
                                                            <div class="max-320 font-0">
                                                                <span class="chatbox-bodyheader-designation vertical-align-middle d-inline-block">
                                                                    {{job?.job_title}} ...
                                                                </span>
                                                                <span class="vertical-align-middle d-inline-block">
                                                                    <a href="javascript:void(0)" routerLink="/mentor/booking-request/{{job?._id}}" class="anchor--primary font-14">View job post</a>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div *ngIf="job?.job_status == 'PENDING'" class="col-lg-4 mt-2 mt-lg-0 text-lg-right">
                                                    <button (click)="showUpdateBookingRequestPopup(job?._id, job?.parent_id, 'ACCEPTED')" role="button" type="button" class="primary--button mr-2 py-1 btn-fit">Accept</button>

                                                    <button (click)="showUpdateBookingRequestPopup(job?._id, job?.parent_id, 'CANCELLED')" role="button" type="button" class="alt--button py-1 btn-fit">Decline</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="chatbox-bodycontent pb-0">
                                            <div class="chatbox-bodycontent-lock">
                                                <i class="fa fa-lock"></i> {{job?.mentor?.first_name}} {{job?.mentor?.last_name}} started the chat with {{job?.parent?.first_name}} {{job?.parent?.last_name}} on {{job?.created_at | date}}
                                            </div>
                                            <div class="chatbox-bodycontent-msgarea pb-0">

                                                <ul class="chatlist--modification">
                                                    <ngx-simplebar [options]="options">
                                                        <li *ngFor="let message of job?.messages; let i= index;" [ngClass]="{'row-all-reverse ': message?.sender_id === job?.mentor_id}" class="chatbox-bodycontent-msgarea-quote">

                                                            <span class="menu-profile-pic">
                                                                <img alt="profile-pic" [src]="message?.sender?.profileImagePath">
                                                            </span>
                                                            <div class="chatbox-bodycontent-msgarea-quote-subject">
                                                                <p>{{message?.message}}</p>

                                                                <ng-container *ngIf="message?.message_file">
                                                                    <p *ngFor="let file of message?.message_file; let messageFileIndex = index;">
                                                                        <a class="message-file-name" href="{{file?.file_path}}" target="_blank">{{file?.file_name}}</a>
                                                                    </p>
                                                                </ng-container>



                                                                <div class="chatbox-bodycontent-msgarea-time">
                                                                    <p><span>{{message?.created_at | date:'medium'}}</span></p>
                                                                </div>
                                                            </div>

                                                        </li>
                                                    </ngx-simplebar>
                                                </ul>
                                                <div *ngIf="job?.job_status == 'PENDING'" class="mt-4 mb-2">
                                                    <div class="chat--docsarea">
                                                        <div class="mx-auto max-650">
                                                            <p class="sent--quote text-center mb-2">
                                                                You recieve a Booking Request from {{job?.parent?.first_name}} {{job?.parent?.last_name}}
                                                                <a href="javascript:void(0)" class="anchor--primary" routerLink="/mentor/booking-request/{{job?._id}}">View Job Details</a>
                                                            </p>
                                                            <div class="row mt-3">
                                                                <div class="col-sm-4 col-md-6 col-lg-4 mb-responsive">
                                                                    <span class="sent--quote-subtitle text-center mb-1">Date</span>
                                                                    <p class="sent--quote text-center">
                                                                        {{(job?.booking_date)}}
                                                                    </p>
                                                                </div>
                                                                <div class="col-sm-4 col-md-6 col-lg-4 mb-responsive">
                                                                    <span class="sent--quote-subtitle text-center mb-1">time</span>
                                                                    <p class="sent--quote text-center">
                                                                        {{(job?.booking_time)}}
                                                                    </p>
                                                                </div>
                                                                <div class="col-sm-4 col-md-6 col-lg-4 mb-responsive">
                                                                    <span class="sent--quote-subtitle text-center mb-1">hourly rate</span>
                                                                    <p class="sent--quote text-center">
                                                                        ${{(job?.hourly_rate)}}/Hr
                                                                    </p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="chatbox-bodycontent-msgarea-time text-right mt-2 px-4">
                                                        <div class="row align-items-center">
                                                            <div class="col-lg-7 col-xl-8 mb-3 mb-xl-0">
                                                                <button (click)="showUpdateBookingRequestPopup(job?._id, job?.parent_id, 'ACCEPTED')" role="button" type="button" class="primary--button py-1 font-14 mr-2">Accept</button>

                                                                <button (click)="showUpdateBookingRequestPopup(job?._id, job?.parent_id, 'CANCELLED')" role="button" type="button" class="primary--button-bordered py-1 font-14">Decline</button>
                                                            </div>
                                                            <div class="col-lg-5 col-xl-4">
                                                                <p><span>{{job?.created_at | date:'medium'}}</span></p>

                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                                <ng-container *ngIf="job?.job_status == 'ACCEPTED'; else noChatRoomAvailable">

                                                    <form [formGroup]="messageForm">
                                                        <div class="chatbox-bodycontent-sentarea d-flex align-items-center">

                                                            <div class="chatbox-bodycontent-sentarea--upload">

                                                                <div class="dropzone dropzone-container" [dropzone]="messageFileConfiguration" [disabled]="disabled"></div>

                                                            </div>
                                                            <div class="chatbox-bodycontent-sentarea--input" aria-labelledby="chatinputArea">
                                                                <input type="text" formControlName="message" class="type--msgarea" placeholder="Type a message...">

                                                                <p class="errorCls" *ngIf="messageForm.controls.message.touched || isMessageFormSubmitted">
                                                                    <app-form-validation-errors minLength=1 maxLength=5000 errorPrefix="Message " [errors]="messageForm.get('message').errors"></app-form-validation-errors>
                                                                </p>
                                                            </div>
                                                            <div class="chatbox-bodycontent-sentarea--formbtn">

                                                                <button [disabled]="messageForm.invalid" (click)="onSubmitMessageForm()" type="submit" class="w-100 btn--transparent">

                                                                <span class="mobile-sent--btn d-sm-none"><i class="fa fa-paper-plane" aria-hidden="true"></i></span>

                                                                <span class="primary--button px-4 d-none d-sm-inline-block w-100">Reply</span>
                                                            </button>
                                                            </div>

                                                        </div>

                                                        <div *ngIf="checkObjectLength(messageFileArray.value) > 0" class="inner_box">

                                                            <div class="box_outer inline-pdf-section">
                                                                <span class="relative_images">
                                                                    <span *ngFor="let messageFile of messageFileArray.value | keyvalue; let messageFileIndex = index;" class="img_box">
                                                                        

                                                                        <a title="{{messageFile.value.file_name}}" class="file_name" href="{{messageFile.value.file_path}}" target="_blank">
                                                                              {{messageFile.value.file_name}}  
                                                                        </a>
                                                                        <div class="remove-file">
                                                                            <i (click)="removeFile(messageFile.key, 'messages ',messageFile.value.file_key)" class="fa fa-times" aria-hidden="true"></i>
                                                                        </div>
                                                                    </span>
                                                                </span>
                                                            </div>
                                                        </div>


                                                    </form>
                                                </ng-container>
                                                <ng-template #noChatRoomAvailable>
                                                    <div *ngIf="job?.job_status != 'PENDING'" class="p-4 border-dashed-top bg-white">
                                                        <div class="mx-auto max-650">
                                                            <p class="sent--quote text-center mb-1">
                                                                Job has been filed as {{job?.job_status | lowercase}}.
                                                            </p>
                                                            <p class="sent--quote text-center mb-1 color--text">
                                                                This chat room is no more available.
                                                            </p>
                                                            <div class="chatbox-bodycontent-msgarea-time text-center mb-1">
                                                                <p><span>{{job?.created_at | date:'medium'}}</span></p>
                                                            </div>
                                                            <p class="sent--quote text-center">
                                                                <a routerLink="/mentor/booking-request/{{job?._id}}" href="javascript:void(0))" class="anchor--primary">View Job Details</a>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </ng-template>

                                            </div>
                                        </div>
                                    </ng-container>
                                    <ng-template #noMessagesFound>
                                        <div class="nochat-area">
                                            <div class="mx-auto">
                                                <div class="mx-auto d-blcok text-center mb-3">
                                                    <img src="assets/img/noresult-chatboxicon.svg" alt="chatnotfound-icon">
                                                </div>
                                                <p class="mobile-pagetop-heading mb-2 text-center">No Messages Yet</p>
                                                <p class="mobile-pagetop-subheading d-block text-center max-350 mx-auto mb-4">Once you connect with a parent, your messages will be displayed here. </p>

                                            </div>
                                        </div>
                                    </ng-template>
                                </div>
                            </ng-container>

                        </ng-template>
                    </div>
                </div>
            </div>
        </div>
    </div>

</section>


<app-update-booking-request (showUpdateBookingRequestPopup)="showUpdateBookingRequestPopup(getJobId, getParentId, getJobStatus)" (hideUpdateBookingRequestPopup)="hideUpdateBookingRequestPopup($event)" [getParentId]="getParentId" [getJobStatus]="getJobStatus"
    [getJobId]="getJobId" [isOpen]="isBookingMethodModalOpen"></app-update-booking-request>

<ngx-ui-loader></ngx-ui-loader>